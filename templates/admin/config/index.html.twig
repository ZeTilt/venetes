{% extends 'admin/base.html.twig' %}

{% block page_title %}Configuration du site{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="bg-white shadow rounded-lg">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-medium text-gray-900">Informations du club</h3>
            <p class="mt-1 text-sm text-gray-600">
                Configurez les informations générales qui s'affichent sur le site web.
            </p>
        </div>
        
        <form action="{{ path('admin_config_save') }}" method="POST" enctype="multipart/form-data" class="p-6 space-y-6">
            <!-- Nom du club -->
            <div>
                <label for="club_name" class="block text-sm font-medium text-gray-700 mb-1">
                    Nom du club
                </label>
                <input type="text" 
                       id="club_name" 
                       name="club_name" 
                       value="{{ clubInfo.name }}"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-club-orange focus:border-club-orange"
                       required>
            </div>

            <!-- Adresse -->
            <div>
                <label for="club_address" class="block text-sm font-medium text-gray-700 mb-1">
                    Adresse du club
                </label>
                <textarea id="club_address" 
                          name="club_address" 
                          rows="3"
                          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-club-orange focus:border-club-orange"
                          required>{{ clubInfo.address }}</textarea>
                <p class="mt-1 text-sm text-gray-500">
                    Cette adresse s'affichera dans le footer et les pages de contact.
                </p>
            </div>

            <!-- Téléphone -->
            <div>
                <label for="club_phone" class="block text-sm font-medium text-gray-700 mb-1">
                    Numéro de téléphone
                </label>
                <input type="tel"
                       id="club_phone"
                       name="club_phone"
                       value="{{ clubInfo.phone }}"
                       placeholder="Optionnel"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-club-orange focus:border-club-orange">
                <p class="mt-1 text-sm text-gray-500">
                    Laissez vide pour ne pas afficher de téléphone sur le site.
                </p>
            </div>

            <!-- Email -->
            <div>
                <label for="club_email" class="block text-sm font-medium text-gray-700 mb-1">
                    Adresse email
                </label>
                <input type="email" 
                       id="club_email" 
                       name="club_email" 
                       value="{{ clubInfo.email }}"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-club-orange focus:border-club-orange"
                       required>
            </div>

            <!-- Facebook -->
            <div>
                <label for="club_facebook" class="block text-sm font-medium text-gray-700 mb-1">
                    Page Facebook
                </label>
                <input type="url" 
                       id="club_facebook" 
                       name="club_facebook" 
                       value="{{ clubInfo.facebook }}"
                       placeholder="https://www.facebook.com/..."
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-club-orange focus:border-club-orange">
                <p class="mt-1 text-sm text-gray-500">
                    URL complète de votre page Facebook (optionnel).
                </p>
            </div>

            <!-- HelloAsso URL -->
            <div>
                <label for="helloasso_url" class="block text-sm font-medium text-gray-700 mb-1">
                    Lien HelloAsso pour les adhésions
                </label>
                <input type="url" 
                       id="helloasso_url" 
                       name="helloasso_url" 
                       value="{{ site_config('helloasso_url') }}"
                       placeholder="https://www.helloasso.com/associations/..."
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-club-orange focus:border-club-orange">
                <p class="mt-1 text-sm text-gray-500">
                    Lien vers votre formulaire d'adhésion HelloAsso.
                </p>
            </div>

            <!-- Tarifs PDF -->
            <div>
                <label for="tarifs_pdf" class="block text-sm font-medium text-gray-700 mb-1">
                    Fichier PDF des tarifs
                </label>
                {% set currentTarifs = site_config('tarifs_pdf') %}
                {% if currentTarifs %}
                    <div class="mb-3 p-3 bg-green-50 border border-green-200 rounded-md">
                        <div class="flex items-center">
                            <svg class="w-5 h-5 text-green-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                            </svg>
                            <span class="text-sm text-green-700">
                                Fichier actuel:
                                <a href="{{ currentTarifs }}" target="_blank" class="text-green-800 hover:underline font-medium">
                                    {{ currentTarifs|split('/')|last }}
                                </a>
                            </span>
                        </div>
                    </div>
                {% endif %}
                <input type="file"
                       id="tarifs_pdf"
                       name="tarifs_pdf"
                       accept=".pdf"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-club-orange focus:border-club-orange">
                <p class="mt-1 text-sm text-gray-500">
                    Uploadez un fichier PDF contenant les tarifs du club (optionnel).
                </p>
            </div>

            <!-- Hero Images -->
            <div class="border-t border-gray-200 pt-6">
                <label class="block text-sm font-medium text-gray-700 mb-3">
                    Images du carousel d'accueil
                </label>

                {% set heroImages = site_config('hero_images')|default('[]')|json_decode %}

                <!-- Current images -->
                {% if heroImages|length > 0 %}
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4" id="hero-images-list">
                        {% for image in heroImages %}
                            <div class="relative group" data-image="{{ image }}">
                                <img src="{{ image }}" alt="Hero image" class="w-full h-24 object-cover rounded-lg border border-gray-200">
                                <button type="button"
                                        onclick="removeHeroImage('{{ image }}')"
                                        class="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                    </svg>
                                </button>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-sm text-gray-500 mb-4">Aucune image configurée. Les images par défaut seront utilisées.</p>
                {% endif %}

                <!-- Hidden input for storing images list -->
                <input type="hidden" name="hero_images" id="hero_images_input" value="{{ heroImages|json_encode }}">

                <!-- Upload new images -->
                <input type="file"
                       id="hero_images_upload"
                       name="hero_images_upload[]"
                       accept="image/*"
                       multiple
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-club-orange focus:border-club-orange">
                <p class="mt-1 text-sm text-gray-500">
                    Sélectionnez une ou plusieurs images (format recommandé : 1080x500 pixels). Les images existantes seront conservées.
                </p>
            </div>

            <!-- Actions -->
            <div class="flex justify-end space-x-3 pt-6 border-t border-gray-200">
                <button type="submit" 
                        class="bg-club-orange text-white px-4 py-2 rounded-md hover:bg-club-orange-dark focus:outline-none focus:ring-2 focus:ring-club-orange focus:ring-offset-2">
                    Sauvegarder
                </button>
            </div>
        </form>
    </div>
</div>

<script>
function removeHeroImage(imagePath) {
    if (!confirm('Supprimer cette image du carousel ?')) return;

    const input = document.getElementById('hero_images_input');
    let images = JSON.parse(input.value || '[]');
    images = images.filter(img => img !== imagePath);
    input.value = JSON.stringify(images);

    // Remove from DOM
    const container = document.querySelector(`[data-image="${imagePath}"]`);
    if (container) container.remove();

    // Show message if no images left
    const list = document.getElementById('hero-images-list');
    if (list && list.children.length === 0) {
        list.outerHTML = '<p class="text-sm text-gray-500 mb-4">Aucune image configurée. Les images par défaut seront utilisées.</p>';
    }
}
</script>
{% endblock %}