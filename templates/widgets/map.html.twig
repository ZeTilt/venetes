<div class="widget-map">
    {% if config.title is defined and config.title %}
        <h3 class="widget-title">{{ config.title }}</h3>
    {% endif %}
    <div class="widget-map-container">
        {% if config.api_key is defined and config.api_key %}
        {# Utiliser l'API Embed v1 avec clé #}
        <iframe
            src="https://www.google.com/maps/embed/v1/place?key={{ config.api_key }}&q={{ address|url_encode }}&zoom={{ zoom }}"
            width="100%"
            height="400"
            style="border:0; border-radius: 0.5rem;"
            allowfullscreen=""
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade">
        </iframe>
        {% else %}
        {# Embed classique sans clé (comme l'ancien site) #}
        <iframe
            src="https://www.google.com/maps?q={{ address|url_encode }}&output=embed"
            width="100%"
            height="400"
            style="border:0; border-radius: 0.5rem;"
            allowfullscreen=""
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade">
        </iframe>
        {% endif %}
    </div>
    {% if config.show_address|default(true) %}
        <p class="widget-map-address">
            <svg class="inline-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
            </svg>
            {{ address }}
        </p>
    {% endif %}
</div>
